---
phase: 10-edge-cases
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - optimizer/src/transform.rs
autonomous: true

must_haves:
  truths:
    - "Files without QRL markers pass through with minimal transformation"
    - "Unicode identifiers preserved correctly in output"
    - "Generator functions inside components work correctly"
  artifacts:
    - path: "optimizer/src/transform.rs"
      provides: "Edge case handling for empty, unicode, and generator tests"
  key_links:
    - from: "transform"
      to: "output"
      via: "pass-through for non-QRL files"
---

<objective>
Handle edge cases: empty/pass-through files, unicode identifiers, and generator functions.

Purpose: Ensure optimizer handles edge cases correctly without transformation errors.

Output: Tests validating these edge cases pass.
</objective>

<execution_context>
@/Users/jackshelton/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jackshelton/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-edge-cases/10-RESEARCH.md
@optimizer/src/transform.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add test for empty/pass-through files (issue_117)</name>
  <files>optimizer/src/transform.rs</files>
  <action>
Add test `test_issue_117_empty_passthrough` for files without QRL markers:

Input (from issue_117.snap):
```javascript
export const cache = patternCache[cacheKey] || (patternCache[cacheKey]={});
```

Verify:
- No QRL extraction occurs (components vector is empty)
- Output preserves original code structure
- No errors in error vector
- File passes through without transformation issues

This validates that the optimizer doesn't fail or produce incorrect output for files that don't use Qwik's $ markers.
  </action>
  <verify>Test passes with `~/.cargo/bin/cargo test test_issue_117 --lib`</verify>
  <done>Empty/pass-through file test added and passing</done>
</task>

<task type="auto">
  <name>Task 2: Add test for generator functions (issue_964)</name>
  <files>optimizer/src/transform.rs</files>
  <action>
Add test `test_issue_964_generator_function` for generator functions inside components:

Input (from issue_964.snap):
```javascript
import { component$ } from '@qwik.dev/core';

export const App = component$(() => {
  console.log(function*(lo: any, t: any) {
    console.log(yield (yield lo)(t.href).then((r) => r.json()));
  });

  return <p>Hello Qwik</p>;
});
```

Verify:
- Generator function syntax preserved in output segment
- `function*` keyword not stripped
- yield expressions preserved correctly
- Component extracts and transforms normally
- No errors in error vector

This validates that generator functions inside QRL bodies are preserved correctly.
  </action>
  <verify>Test passes with `~/.cargo/bin/cargo test test_issue_964 --lib`</verify>
  <done>Generator function test added and passing</done>
</task>

<task type="auto">
  <name>Task 3: Add test for unicode identifiers</name>
  <files>optimizer/src/transform.rs</files>
  <action>
Add test `test_unicode_identifiers` for unicode in variable/function names:

Input:
```javascript
import { component$ } from '@qwik.dev/core';

export const Κomponent = component$(() => {
  const 日本語 = 'Japanese';
  const données = { value: 'French' };
  return <div>{日本語} - {données.value}</div>;
});
```

Verify:
- Unicode variable names preserved in capture arrays
- Unicode component name preserved in segment name
- No encoding issues in output
- Hash generation works with unicode input

OXC handles unicode natively through Rust's string handling, but this test ensures the full pipeline handles it correctly.
  </action>
  <verify>Test passes with `~/.cargo/bin/cargo test test_unicode --lib`</verify>
  <done>Unicode identifier test added and passing</done>
</task>

</tasks>

<verification>
1. `~/.cargo/bin/cargo check --lib` - No compilation errors
2. `~/.cargo/bin/cargo test --lib` - All tests pass
3. Edge case tests validate correct behavior
</verification>

<success_criteria>
- Files without QRL markers pass through correctly
- Generator functions preserved in QRL segments
- Unicode identifiers work throughout the pipeline
- All three edge case tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/10-edge-cases/10-03-SUMMARY.md`
</output>
