---
phase: 11-research-code-cleanup
plan: 05
type: execute
wave: 5
depends_on: ["11-04"]
files_modified:
  - optimizer/src/transform/mod.rs
  - optimizer/src/transform/generator.rs
  - optimizer/src/lib.rs
autonomous: true

must_haves:
  truths:
    - "All transform/ modules are under 500 lines each"
    - "No module exceeds recommended complexity"
    - "All 233 tests still pass"
    - "Public API unchanged from original transform.rs"
    - "Documentation compiles without warnings"
  artifacts:
    - path: "optimizer/src/transform/mod.rs"
      provides: "Module root with clean re-exports"
      max_lines: 100
    - path: "optimizer/src/transform/generator.rs"
      provides: "TransformGenerator with dispatcher Traverse impl"
      max_lines: 1000
  key_links:
    - from: "optimizer/src/lib.rs"
      to: "optimizer/src/transform/mod.rs"
      via: "pub use transform"
      pattern: "pub use transform"
---

<objective>
Final cleanup and verification of the modularized transform/ directory.

Purpose: Ensure all modules meet size targets (<500 lines for domain modules, <1000 for generator), clean up any remaining issues, verify public API compatibility, and document the new structure.

Output: Clean, well-organized transform/ directory with all requirements met.
</objective>

<execution_context>
@/Users/jackshelton/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jackshelton/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/11-research-code-cleanup/11-RESEARCH.md
@.planning/phases/11-research-code-cleanup/11-04-SUMMARY.md

# All transform modules
@optimizer/src/transform/mod.rs
@optimizer/src/transform/generator.rs
@optimizer/src/transform/state.rs
@optimizer/src/transform/options.rs
@optimizer/src/transform/jsx.rs
@optimizer/src/transform/qrl.rs
@optimizer/src/transform/scope.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify module sizes and split if needed</name>
  <files>optimizer/src/transform/*.rs</files>
  <action>
1. Check line counts for all transform/ modules:
   ```
   wc -l optimizer/src/transform/*.rs
   ```

2. For any module over 500 lines (except generator.rs which has 1000 limit):
   - Identify logical sub-components
   - Consider splitting into sub-modules (e.g., jsx/element.rs, jsx/attribute.rs)
   - Only split if there's a clear semantic boundary

3. For generator.rs if over 1000 lines:
   - Look for any remaining logic that could be extracted
   - Check if imports section can be consolidated with a prelude

4. Ensure no module is under 50 lines (over-modularization) - combine if needed

5. Update mod.rs re-exports if any splits were made

Target sizes from 11-RESEARCH.md:
- generator.rs: <1000 lines (dispatcher + struct)
- state.rs: <500 lines
- options.rs: <300 lines
- jsx.rs: <500 lines
- qrl.rs: <400 lines
- scope.rs: <300 lines
  </action>
  <verify>
Run `wc -l optimizer/src/transform/*.rs` - all modules within limits.
  </verify>
  <done>
- All modules within size limits
- No over-modularization
- Clean module boundaries
  </done>
</task>

<task type="auto">
  <name>Task 2: Clean up and verify public API</name>
  <files>optimizer/src/transform/mod.rs, optimizer/src/lib.rs</files>
  <action>
1. Review optimizer/src/transform/mod.rs:
   - Ensure all public types are re-exported
   - Clean up any unused re-exports
   - Add module-level documentation comment

2. Review optimizer/src/lib.rs:
   - Verify transform module exports match original public API
   - Check that external code would see no difference

3. Compare public API with original transform.rs:
   - TransformOptions should be public
   - transform() function should be public
   - TransformGenerator might be internal (check usage)
   - JsxState, ImportTracker likely internal

4. Run clippy to catch any issues:
   ```
   cargo clippy -p optimizer -- -D warnings
   ```

5. Fix any warnings related to:
   - Unused imports
   - Dead code
   - Visibility issues
  </action>
  <verify>
Run `cargo clippy -p optimizer -- -D warnings` - no warnings.
Run `cargo doc -p optimizer --no-deps` - docs generate cleanly.
  </verify>
  <done>
- Public API unchanged
- No clippy warnings
- Documentation generates
  </done>
</task>

<task type="auto">
  <name>Task 3: Final test run and requirements verification</name>
  <files>None (verification only)</files>
  <action>
1. Run the complete test suite:
   ```
   cargo test -p optimizer --no-fail-fast
   ```
   All 233 tests must pass.

2. Run benchmarks if they exist:
   ```
   cargo bench -p optimizer 2>/dev/null || echo "No benchmarks"
   ```

3. Verify requirements CLN-01 through CLN-05:
   - CLN-01: OXC API research documented (11-RESEARCH.md exists) [DONE]
   - CLN-02: OXC ecosystem projects analyzed (in 11-RESEARCH.md) [DONE]
   - CLN-03: Rust ecosystem libraries evaluated (in 11-RESEARCH.md) [DONE]
   - CLN-04: transform.rs split into logical modules (<500 lines each)
     - Verify: `ls optimizer/src/transform/` and `wc -l`
   - CLN-05: All 233 tests still pass after refactoring

4. Create summary of final module structure:
   ```
   optimizer/src/transform/
   ├── mod.rs        (~X lines) - Module root, re-exports
   ├── generator.rs  (~X lines) - TransformGenerator, Traverse impl
   ├── state.rs      (~X lines) - JsxState, ImportTracker
   ├── options.rs    (~X lines) - TransformOptions, transform()
   ├── jsx.rs        (~X lines) - JSX transformation helpers
   ├── qrl.rs        (~X lines) - QRL extraction helpers
   └── scope.rs      (~X lines) - Scope tracking helpers
   ```

5. Compare to original:
   - Original transform.rs: 7571 lines
   - New total: Sum of all modules (should be ~3000)
   - Tests moved to: optimizer/src/transform_tests.rs (~4500 lines)
  </action>
  <verify>
Run `cargo test -p optimizer` - 233 passed.
Run `wc -l optimizer/src/transform/*.rs | tail -1` - total under 3500 lines.
  </verify>
  <done>
- All 233 tests pass
- All CLN requirements verified
- Module structure documented
- Original 7571-line file now organized into ~7 modules totaling ~3000 lines
  </done>
</task>

</tasks>

<verification>
1. All tests: `cargo test -p optimizer` shows 233 passed
2. Module sizes: `wc -l optimizer/src/transform/*.rs` all within limits
3. No warnings: `cargo clippy -p optimizer -- -D warnings` clean
4. Docs: `cargo doc -p optimizer --no-deps` generates
5. Total lines: `wc -l optimizer/src/transform/*.rs | tail -1` < 3500
</verification>

<success_criteria>
- All 233 tests pass
- All transform/ modules under size limits
- No clippy warnings
- Documentation compiles
- CLN-01 through CLN-05 requirements met
- Original 7571-line transform.rs now organized into modular structure
</success_criteria>

<output>
After completion, create `.planning/phases/11-research-code-cleanup/11-05-SUMMARY.md`
</output>
