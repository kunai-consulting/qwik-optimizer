---
phase: 11-research-code-cleanup
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - optimizer/src/transform.rs
  - optimizer/src/transform/mod.rs
  - optimizer/src/transform/state.rs
  - optimizer/src/transform/options.rs
  - optimizer/src/lib.rs
autonomous: true

must_haves:
  truths:
    - "TransformOptions struct is in a dedicated options.rs file"
    - "JsxState and ImportTracker structs are in a dedicated state.rs file"
    - "All 233 tests still pass"
    - "transform.rs re-exports maintain backward compatibility"
  artifacts:
    - path: "optimizer/src/transform/state.rs"
      provides: "JsxState, ImportTracker structs and impls"
      contains: "pub struct JsxState"
    - path: "optimizer/src/transform/options.rs"
      provides: "TransformOptions struct and transform() function"
      contains: "pub struct TransformOptions"
    - path: "optimizer/src/transform/mod.rs"
      provides: "Module root with re-exports"
      contains: "pub use"
  key_links:
    - from: "optimizer/src/lib.rs"
      to: "optimizer/src/transform/mod.rs"
      via: "mod transform"
      pattern: "mod transform"
---

<objective>
Extract state structs (JsxState, ImportTracker) and TransformOptions to dedicated modules within a transform/ directory.

Purpose: Continue reducing transform.rs size by separating concerns. State management and configuration are distinct from transformation logic. This establishes the transform/ directory structure for subsequent modularization.

Output: transform/ directory with state.rs and options.rs modules, transform.rs reduced further.
</objective>

<execution_context>
@/Users/jackshelton/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jackshelton/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/11-research-code-cleanup/11-RESEARCH.md
@.planning/phases/11-research-code-cleanup/11-01-SUMMARY.md

# Source file (post-test extraction)
@optimizer/src/transform.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create transform/ directory with state.rs</name>
  <files>optimizer/src/transform/mod.rs, optimizer/src/transform/state.rs</files>
  <action>
1. Create optimizer/src/transform/ directory

2. Create optimizer/src/transform/state.rs containing:
   - JsxState struct and all its impl blocks
   - ImportTracker struct and all its impl blocks
   - Any helper types used only by these structs
   - Necessary imports (oxc_ast, oxc_allocator, etc.)

3. Create optimizer/src/transform/mod.rs:
   - `mod state;`
   - `pub use state::{JsxState, ImportTracker};`
   - This will grow as more modules are added

4. In transform.rs:
   - Remove JsxState and ImportTracker definitions
   - Add `use crate::transform::state::{JsxState, ImportTracker};` or let mod.rs re-export

Note: JsxState is approximately lines 50-200 in transform.rs (verify exact boundaries).
ImportTracker is approximately lines 200-370 (verify exact boundaries).

The goal is to extract these WITHOUT changing their behavior or API.
  </action>
  <verify>
Run `cargo check -p optimizer` - should compile without errors.
Run `cargo test -p optimizer --lib` - library tests should pass.
  </verify>
  <done>
- transform/state.rs exists with JsxState and ImportTracker
- transform/mod.rs exists with re-exports
- Code compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Extract TransformOptions to options.rs</name>
  <files>optimizer/src/transform/options.rs, optimizer/src/transform/mod.rs, optimizer/src/transform.rs</files>
  <action>
1. Create optimizer/src/transform/options.rs containing:
   - TransformOptions struct definition
   - TransformOptions impl block (new(), is_dev(), etc.)
   - The public `transform()` function (main entry point)
   - Any related types (MinifyMode, TranspileTarget if defined here)

2. Update optimizer/src/transform/mod.rs:
   - Add `mod options;`
   - Add `pub use options::{TransformOptions, transform};`

3. In transform.rs:
   - Remove TransformOptions definition and impls
   - Remove the transform() function
   - Keep TransformGenerator and impl Traverse

4. Update optimizer/src/lib.rs if needed:
   - Ensure transform module exports are correct
   - The public API should remain unchanged

TransformOptions is approximately at the end of the production code section.
  </action>
  <verify>
Run `cargo test -p optimizer` - all 233 tests should pass.
Run `wc -l optimizer/src/transform.rs` - should be reduced by ~200-300 lines from state + options extraction.
  </verify>
  <done>
- transform/options.rs exists with TransformOptions and transform()
- All 233 tests pass
- transform.rs reduced in size
  </done>
</task>

<task type="auto">
  <name>Task 3: Update lib.rs and verify backward compatibility</name>
  <files>optimizer/src/lib.rs, optimizer/src/transform.rs, optimizer/src/transform/generator.rs</files>
  <action>
1. Rename transform.rs to optimizer/src/transform/generator.rs:
   - Contains only TransformGenerator struct and impl Traverse
   - Update imports to use sibling modules (state, options)
   - Add the following use statements at the top of generator.rs:
     ```rust
     use crate::transform::state::{JsxState, ImportTracker};
     use crate::transform::options::TransformOptions;
     ```

2. Update optimizer/src/transform/mod.rs:
   - Add `mod generator;`
   - Add `pub use generator::TransformGenerator;`
   - Re-export everything that was public from original transform.rs

3. Update optimizer/src/lib.rs:
   - Change `mod transform;` to point to directory module
   - Maintain all public exports: `pub use transform::{TransformOptions, transform, ...};`

4. Delete the old transform.rs file if it still exists at optimizer/src/transform.rs
   (Rust module system will now use optimizer/src/transform/mod.rs)

5. Run full test suite to verify no regressions

NOTE: Code will not compile after Task 2 until this task completes the rename and import updates. This is expected - the transform.rs file references types that have moved to state.rs and options.rs, and those references need to be updated when the file becomes generator.rs.

IMPORTANT: Do NOT change any public API. External code should see no difference.
  </action>
  <verify>
Run `cargo test -p optimizer --no-fail-fast` - all 233 tests pass.
Run `cargo doc -p optimizer --no-deps` - documentation generates without warnings.
  </verify>
  <done>
- transform/ is now a directory module with mod.rs, state.rs, options.rs, generator.rs
- All public exports maintained
- All 233 tests pass
- Documentation generates correctly
  </done>
</task>

</tasks>

<verification>
1. Directory structure: `ls optimizer/src/transform/` shows mod.rs, state.rs, options.rs, generator.rs
2. Tests pass: `cargo test -p optimizer` shows 233 passed
3. Public API unchanged: `cargo doc -p optimizer` generates without warnings
4. No old file: `test ! -f optimizer/src/transform.rs` (file should not exist at root)
</verification>

<success_criteria>
- transform/ directory module created
- JsxState, ImportTracker in state.rs
- TransformOptions, transform() in options.rs
- TransformGenerator in generator.rs
- All 233 tests pass
- Public API unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/11-research-code-cleanup/11-02-SUMMARY.md`
</output>
